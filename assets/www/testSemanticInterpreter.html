<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

	<title>Semantic Parser Test</title>

	<!--
		Copyright (C) 2012-2013 DFKI GmbH
		Deutsches Forschungszentrum fuer Kuenstliche Intelligenz
		German Research Center for Artificial Intelligence
		http://www.dfki.de

		Permission is hereby granted, free of charge, to any person obtaining a 
		copy of this software and associated documentation files (the 
		"Software"), to deal in the Software without restriction, including 
		without limitation the rights to use, copy, modify, merge, publish, 
		distribute, sublicense, and/or sell copies of the Software, and to 
		permit persons to whom the Software is furnished to do so, subject to 
		the following conditions:

		The above copyright notice and this permission notice shall be included 
		in all copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS 
		OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF 
		MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
		IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY 
		CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, 
		TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
		SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	-->
	
    <link rel="stylesheet" href="mmirf/res/styles/jquery.mobile-1.3.1.min.css" />
    
	<script src="mmirf/res/libs/jquery-1.9.1.min.js" type="text/javascript">
	</script>
	<script type="text/javascript">
		//disable jQuery Mobiles navigation/history handling (-> allow simple # links within page)
		//NOTE this needs to be done, before jQuery Mobile JS is loaded!
		$(document).on("mobileinit", function(){
			$.mobile.hashListeningEnabled = false;
			$.mobile.pushStateEnabled = false;
			$.mobile.linkBindingEnabled = false;
		});
	</script>
	<script src="mmirf/res/libs/jquery.mobile-1.3.1.js" type="text/javascript">
	</script>


	<script src="mmirf/res/libs/jpath.js" type="text/javascript">
	</script>
	<script src="mmirf/tools/initJSCC.js" type="text/javascript">
	</script>
	<script src="mmirf/res/libs/jscc.js" type="text/javascript"> 
	</script>

	<script src="mmirf/semantic/grammarConverter.js" type="text/javascript">
	</script>
	
	<script src="mmirf/tools/extensions/StringExtensions.js" type="text/javascript">
	</script>
	<script src="mmirf/tools/constants.js" type="text/javascript">
	</script>
	<script src="mmirf/plugins/directoryListing.js" type="text/javascript">
	</script>
	<script src="mmirf/tools/CommonUtils.js" type="text/javascript">
	</script>
	<script src="mmirf/manager/settings/languageManager.js" type="text/javascript">
	</script>
	
	<script src="mmirf/semantic/grammarParserTemplate.js" type="text/javascript">
	</script>
	<script src="mmirf/semantic/semanticInterpreter.js" type="text/javascript">
	</script>
	
	<!-- script src="mmirf/gen/grammar.js" type="text/javascript">
	</script-->
		
	<style type="text/css">
		
		.grid {
			display: inline-table;
		}
		.grid-cell {
			display: table-cell;
			vertical-align: bottom;
		}
		
		#language-selection-area .ui-select {
			display: inline;
		}
		
		#outputBox {
			font-family:monospace;
			font-size:12px;
			white-space: pre;
			overflow:scroll;
			border: thin solid lightGrey;
			height: 300px;
			width:100%;
		}
		
		code {
			white-space: pre;
		}
		
		#compileOutBox, #compiledParserOutBox {
			font-family:monospace;
			font-size:12px;
			white-space: pre;
			overflow:scroll;
			border: thin solid lightGrey;
			height: 300px;
			width:100%;
		}
		
		#compiledParserOutBox {
			height: 600px;
		}
		
		#interpretationBox, #interpretationBoxAlt {
			font-family:monospace;
			font-size:12px;
			white-space: pre;
			overflow:scroll;
			border: thin solid lightGrey;
			height: 300px;
			width:100%;
		}
		
		#stopwordBox, #stopwordBox2 {
			font-family:monospace;
			font-size:12px;
			white-space: pre;
			overflow:scroll;
			border: thin solid lightGrey;
			height: 3em;
			width:100%;
		}
	</style>
	
<!-- Test Code -->
<script type="text/javascript">
	
	var IS_DEBUG_ENABLED = true;
	
	var IS_FILE_READING_API = false;
	
	if(!console){
		console = new Object();
	}
	if(!console.log){
		console.log = function(msg){ alert(msg);};
	}
	if(!console.debug){
		console.debug = console.log;
	}
	if(!console.info){
		console.info = console.log;
	}
	if(!console.warn){
		console.warn = console.log;
	}
	if(!console.error){
		console.error = console.log;
	}
	
	var mobileDS = window.mobileDS ||
	{};


	var forBrowser = true;
	
	var semanticInterpreter = mobileDS.SemanticInterpreter.getInstance();
	semanticInterpreter.get_json_grammar_url = function(id) { return 'config/languages/'+id+'/grammar.json'; };
	
	//TODO: (1) load directory_strucutre file and detect available JSON grammars, (2) create drop-down menu for languages
	semanticInterpreter.setCurrentGrammar('de');

	var inputElement;
	var interpretElement;
	var stopwordElement;
	
	var compiledParser;
	var compileCount = 0;
	
	var theJSONGrammarURL = semanticInterpreter.get_json_grammar_url('de');
	var theJSONgrammar = 'un-initialized';
	
	var optionGrammarFromFile = 'file-option';
	
	var initPage = function initPageImpl(){
		var languageManager = mobileDS.LanguageManager.getInstance();
		
		//alert('langs: '+languageManager.getLanguages().join(', '));
		
		
		var langs = languageManager.getLanguages();// ['de','en'];//TODO get lang-array from LanguageManager (check for "JSON existing"); default from constants
		var defLang = languageManager.getLanguage();//'de';
		if( ! languageManager.existsGrammar(defLang)){
			for(var i=0, size = langs.length; i < size ; ++i){
				
				if(languageManager.existsGrammar(langs[i])){
					defLang = langs[i];
					break;
				}
			}
		} 
		var langMenu = createLanguageMenu(langs, defLang);
		var isLang = function(id){
			for(var i=0,size=langs.length; i < size; ++i){
				if(langs[i] === id){
					return true;
				}
				return false;
			}
		};
		
		$('#grammar-id').val(defLang);
		
		$('#lang-selector-manual-input').hide();
		$('#lang-selector').replaceWith($.parseHTML(langMenu));
		$('#lang-selector').selectmenu({ inline: true });

		$("#lang-selector").on( "change", function(event, ui) {
			
			var prevLang = $('#grammar-id').val();
			
			var currentLangSelection = $(this).val();
			$('#grammar-id').val(currentLangSelection);
			
			theJSONGrammarURL = semanticInterpreter.get_json_grammar_url(currentLangSelection);
			
			var callback = function (isSuccess){
				if(isSuccess){
					
					//if previous selection was loaded-from-file -> remove file entry
					//	 (a new one will be created, next time a grammar is loaded from file)
					if( !isLang(prevLang) ){
						$('#lang-selector option[value="'+optionGrammarFromFile+'"]').remove();
					}
					
					clearInput();
					clearOut();
					clearInterpret();
					clearStopword();
					
					initPageWithJsonGrammar();
				}
				else {
					// loading failed -> "revert" selection
					$('#lang-selector option[value="'+currentLangSelection+'"]').prop('selected', null);
					if( isLang(prevLang) ){
						$('#lang-selector option[value="'+prevLang+'"]').prop('selected', 'selected');
					}
					else {
						$('#lang-selector option[value="'+optionGrammarFromFile+'"]').prop('selected', 'selected');
					}
					
					$('#lang-selector').selectmenu('refresh', true);
					currentLangSelection = prevLang;
					
					$('#grammar-id').val(prevLang);
					
				}
			};
			loadJsonGrammar(callback);
			
		});
		//overwrite default-impl. for getLanguage (-> use grammar-ID-field value instead of input-field's)
		getLanguage = function(){
			return $('#grammar-id').val();
		}
		
		initFileApi();
		
		if(!inputElement) 
			inputElement = document.getElementById("inputBox");
			
		if(!interpretElement) 
			interpretElement = document.getElementById("interpretationInputBox");
			
		if(!stopwordElement) 
			stopwordElement = document.getElementById("stopwordInputBox");
			

		var callback = function(isSuccess){
			if(isSuccess){
				initPageWithJsonGrammar();
			} 
			else {
				$('#file-selector').trigger('click');
			}
		}
		
		loadJsonGrammar(callback);
	};

	jQuery(document).ready(function(){
		mobileDS.CommonUtils.getInstance().initialize(initPage);
	});
	
	function getLanguage(){
		var id = $('#lang-selector-field').val();
		$('#grammar-id').val(id);
		return id;
	}
	
	function initPageWithJsonGrammar(){
		semanticInterpreter = mobileDS.SemanticInterpreter.getInstance();
		semanticInterpreter.createGrammar(theJSONgrammar, getLanguage());
		//var asr_result = "Radio spielen";
		//var res = mobileDS.SemanticInterpreter.getInstance().getASRSemantic(asr_result.toLowerCase(), getLanguage());
		//var semantic = JSON.parse(res.semantic);
		//console.log("semantic : " + res.semantic);
		
		printGrammarDefinition();
		printInput(JSON.stringify(theJSONgrammar, null, 2));
		printCompiledParserDefinition();
		interpretElement.value = "Radio spielen";
		processInterpretation();
	}
	
	function loadJsonGrammar(cb){
		if(!semanticInterpreter){
			semanticInterpreter = mobileDS.SemanticInterpreter.getInstance();
		}
		
		var successFunc = function(gcInstance){
			if(gcInstance.json_grammar_definition){
				
				theJSONgrammar = gcInstance.json_grammar_definition;
				if(theJSONgrammar['comment_license']){
					delete theJSONgrammar['comment_license'];
				}
				cb(true)
			}
			else{
				cb(false);
			}
		};
		var errorFunc =  function(gcInstance){
			alert("Initialize:\n failed to load JSON grammar file from\n '"+theJSONGrammarURL+"'!");
			cb(false);
		};
		
		var gc = new GrammarConverter();
		
		var doLoadGrammar = function(){
			
			gc.loadGrammar(successFunc, errorFunc, theJSONGrammarURL, false);
			
			if($.mobile){
				$.mobile.loading( 'hide' );
			}
		};
		
		setTimeout(function(){
			if($.mobile){
				$.mobile.loading( 'show', {
					text: 'Loading JSON Grammar...',
					textVisible: true
				});
				setTimeout(function(){ doLoadGrammar(); }, 50);
			}
			else {
				doLoadGrammar();
			}
		},50);
		
	}

	function initFileApi() {
		if (window.File && window.FileReader && window.FileList && window.Blob) {
			IS_FILE_READING_API = true;
			$('#file-selector').on('change', loadJsonGrammarFromFile);
		} 
		else {
			$('#file-selector').hide();
		}
	}

	function loadJsonGrammarFromFile(evt) {
		
		if($.mobile){
			$.mobile.loading( 'show', {
				text: 'Loading JSON Grammar from file...',
				textVisible: true
			});
		}
		
	    var files = evt.target.files; // FileList object
	    
	    // Loop through the FileList (should be only one, since "multiple" is not set)
	    for (var i = 0, f; f = files[i]; i++) {

	      var reader = new FileReader();
	      var theFileName = f.name;
	      
	      // Closure to capture the file information.
	      reader.onload = function(theFileEvent) {
				

				var theGrammarId = prompt('Please enter an ID for the grammar:', theFileName);
				if(theGrammarId === null){
					//cancel selected -> do nothing
					return;///////////////////////////// EARLY EXIT ////////////////////////
				}
				
				var prevSel = $('#grammar-id').val();
				$('#grammar-id').val(theGrammarId);
				
				//update selection menu:
				//	* (if previous selection was a file too: remove the previous entry)
				//	* create an entry for the file selection
				//	* de-select previous entry
				//	* select the new file-entry (and update selection menu)
				$('#lang-selector  option[value="'+optionGrammarFromFile+'"]').remove();
				var fileOptionEntry = createLanguageMenuEntry(theGrammarId, null, null, optionGrammarFromFile);//lang, menuElem, defaultSelection, value);
				$('#lang-selector').append( $.parseHTML(fileOptionEntry.join('')) );
				
				if(prevSel !== optionGrammarFromFile){
					$('#lang-selector option[value="'+prevSel+'"]').prop('selected',null);
				}
				$('#lang-selector option[value="'+optionGrammarFromFile+'"]').prop('selected', 'selected');
				$('#lang-selector').selectmenu('refresh', true);
				
		        clearInput();
		        clearOut();
		        clearInterpret();
		        clearStopword();
		        
				theJSONgrammar = $.parseJSON( theFileEvent.target.result );
				
				if(theJSONgrammar['comment_license']){
					delete theJSONgrammar['comment_license'];
				}
				
				$('#inputBox').val(JSON.stringify(theJSONgrammar, null, 2));
				
				initPageWithJsonGrammar();
				$('#file-selector').val(null);
				
				if($.mobile){
					$.mobile.loading( 'hide' );
				}
	      };

	      reader.onerror = function(theFileEvent) {
	    	  var msg = '';
	    	  var e = theFileEvent.target.error;

	    	  switch (e.code) {
	    	    case FileError.QUOTA_EXCEEDED_ERR:
	    	      msg = 'QUOTA_EXCEEDED_ERR';
	    	      break;
	    	    case FileError.NOT_FOUND_ERR:
	    	      msg = 'NOT_FOUND_ERR';
	    	      break;
	    	    case FileError.SECURITY_ERR:
	    	      msg = 'SECURITY_ERR';
	    	      break;
	    	    case FileError.INVALID_MODIFICATION_ERR:
	    	      msg = 'INVALID_MODIFICATION_ERR';
	    	      break;
	    	    case FileError.INVALID_STATE_ERR:
	    	      msg = 'INVALID_STATE_ERR';
	    	      break;
	    	    default:
	    	      msg = 'Unknown Error';
	    	      break;
	    	  };

	    	  alert('Error: ' + msg);
	      };
	      
	      // Read in the file as text (UTF-8)
	      reader.readAsText(f);
	    }
	}
	
	function parseInput(){
		var text = inputElement.value;
		//console.info('gammar-text: \n'+text);
		try{
			theJSONgrammar = JSON.parse(text);
		} catch(error){
			console.error('error: '+error+'\n'+text);
		}
		clearOut();
		
		semanticInterpreter = mobileDS.SemanticInterpreter.getInstance();
		
		var langCode = getLanguage();
		if( semanticInterpreter.hasGrammar(langCode) ){
			langCode = prompt('About to replace grammar for:\n'
					+langCode
					+'\n\n\nIf you do not want to replace the grammar\n'
					+      'please enter a different ID:'
				, langCode);
			
			if(langCode === null){
				//-> cancel selected
				return;///////////////////////////// EARLY EXIT ////////////////////////
			}
		}

		var doParseAndCompile = function(){
			semanticInterpreter.createGrammar(theJSONgrammar, langCode);//'theGeneratedTestParser' + (++compileCount));
			printGrammarDefinition();
			printCompiledParserDefinition();
			
			if($.mobile){
				$.mobile.loading( 'hide' );
			}
		};
		
		setTimeout(function(){
			if($.mobile){
				$.mobile.loading( 'show', {
					text: 'Parsing and Compiling JSON Grammar...',
					textVisible: true
				});
				setTimeout(function(){ doParseAndCompile(); }, 50);
			}
			else {
				doParseAndCompile();
			}
		},50);

	}
	
	function processInterpretation(){
		
		var asr_result = interpretElement.value;
		var res  = semanticInterpreter.getASRSemantic(    asr_result.toLowerCase());
		var res2 = semanticInterpreter.getASRSemantic_alt(asr_result.toLowerCase());
		clearInterpret();
		
		$('#time').text('');
		$('#time-mod').text('');
		
		printInterpretation(res);
		printInterpretationAlt(res2);
		stopword(asr_result);
	}
	
	function benchmarkInterpretation(){
		
		var asr_result = interpretElement.value;
		var res  = semanticInterpreter.getASRSemantic(    asr_result.toLowerCase());
		var res2 = semanticInterpreter.getASRSemantic_alt(asr_result.toLowerCase());
		clearInterpret();
		
		var DEFAULT_ITERATIONS = 10000;
		var iterations = DEFAULT_ITERATIONS;
		
		iterations = prompt('Starting Benchmark for evaluting Stopword-Processing implementations.'
				+'\n\nWARNING: This may take several minutes.'
				+'\n\nSpecifiy loops for repeat:'
			,iterations
		);
		
		//was cancel selected?
		if(iterations === null){
			return;///////////////////////////// EARLY EXIT ////////////////////////
		}
		
		iterations = parseInt(iterations);
		
		if(isNaN(iterations)){
			iterations = DEFAULT_ITERATIONS;
		}
		
		
		var doStartBenchmark = function(){

			var startTime = new Date();
			for(var i=0; i < iterations; ++i){
				semanticInterpreter.getASRSemantic(asr_result.toLowerCase());
			}
			var diffTime = new Date() - startTime;
			
			var startTimeAlt = new Date();
			for(var i=0; i < iterations; ++i){
				semanticInterpreter.getASRSemantic_alt(asr_result.toLowerCase());
			}
			var diffTimeAlt = new Date() - startTimeAlt;
			
			$('#time').text(iterations + ' interations in ' + diffTime + ' ms');
			$('#time-mod').text(
					iterations + ' interations in ' + diffTimeAlt
							+ ' ms (alt. method)');
			
			printInterpretation(res);
			printInterpretationAlt(res2);
			stopword(asr_result);
			
			if($.mobile){
				$.mobile.loading( 'hide' );
			}
		};
		
		setTimeout(function(){
				if($.mobile){
					$.mobile.loading( 'show', {
						text: 'Benchmarking ('+iterations+' loops)...',
						textVisible: true
					});
					setTimeout(function(){ doStartBenchmark(); }, 500);
				}
				else {
					doStartBenchmark();
				}
			}, 50
		);
		
	}
	
	function stopword(text){
		var sw_result;
		if(typeof text ==='undefined' || text == null){
			sw_result = stopwordElement.value;
		} else {
			sw_result = text;
			stopwordElement.value = sw_result;
		}
		var res  = semanticInterpreter.removeStopwords(   sw_result.toLowerCase(), getLanguage());
		var res2 = semanticInterpreter.removeStopwords_alt(sw_result.toLowerCase(), getLanguage());
		clearStopword();
		printStopword(res, res2);
	}
	
	function printGrammarDefinition(){
		printCompile(semanticInterpreter.getGrammarDefinitionText( getLanguage() ));
	}
	
	function printCompiledParserDefinition(){
		printCompiledParser(semanticInterpreter.getGrammarParserText( getLanguage() ));
	}
	
	function clearInput() {
		$('#inputBox').val('');
	}
	
	function clearOut() {
		var outputBox = document.getElementById("outputBox");
		outputBox.textContent="";
		outputBox = document.getElementById("compileOutBox");
		outputBox.textContent="";
		clearInterpret();
		clearStopword();
	}
	
	function clearInterpret() {
		var outputBox = document.getElementById("interpretationBox");
		outputBox.textContent="";
		outputBox = document.getElementById("interpretationBoxAlt");
		outputBox.textContent="";
	}
	
	function clearStopword() {
		var outputBox = document.getElementById("stopwordBox");
		outputBox.textContent="";
		outputBox = document.getElementById("stopwordBox2");
		outputBox.textContent="";
	}
	
	function _error(msg) {
		print("ERROR: " + msg);
	}

	function _warning(msg) {
		print("WARNING: " + msg);
	}

	function _print(msg) {
		print("INFO: " + msg);
	}
	
	var print = (function () {
		var outputBox;
		return function(text) {
			text = text.replace(/[^\r]\n/g, "\r\n");
			if (!outputBox)
				outputBox = document.getElementById("outputBox");
			if(typeof text == "string") {
				outputBox.appendChild(document.createTextNode(text + "\r\n"));
			} else {
				for(var i=0;i<text.length;i++) {
					outputBox.appendChild(document.createTextNode(text[i]
							+ "\r\n"));
				}
			}
		};
	})();
	
	var printCompile = (function () {
		var outputBoxC;
		return function(text) {
			//text = text.replace(/[^\r]\n/g, "\r\n");
			if (!outputBoxC)
				outputBoxC = document.getElementById("compileOutBox");

			outputBoxC.textContent = text + "\r\n";
		};
	})();
	
	var printCompiledParser = (function () {
		var outputBox;
		return function(text) {
			//text = text.replace(/[^\r]\n/g, "\r\n");
			if (!outputBox)
				outputBox = document.getElementById("compiledParserOutBox");
			if(typeof text == "string") {
				outputBox.textContent = text + "\r\n";
			} else {
				for(var i=0;i<text.length;i++) {
					outputBox.appendChild(document.createTextNode(text[i]
							+ "\r\n"));
				}
			}
		};
	})();
	
	var printInterpretation = function(text) {
		doPrintInterpretation(text, true);
	};
	
	var printInterpretationAlt = function(text) {
		doPrintInterpretation(text, false);
	};
	
	var doPrintInterpretation = (function () {
		var outputBox1;
		var outputBox2;
		return function(text, inNormalNotAlt) {
			if(typeof text == "object") {
				if(typeof text.semantic === 'string'){
					text.semantic = JSON.parse(text.semantic);
				}
				text = JSON.stringify(text, null, 2);
			} else 
				text = text.replace(/[^\r]\n/g, "\r\n");

			if (!outputBox1)
				outputBox1 = document.getElementById("interpretationBox");
			if (!outputBox2)
				outputBox2 = document.getElementById("interpretationBoxAlt");
			
			var outputBox = inNormalNotAlt? outputBox1 : outputBox2;
			
			if(typeof text == "string") {
				outputBox.appendChild(document.createTextNode(text + "\r\n"));
			} else {
				for(var i=0;i<text.length;i++) {
					outputBox.appendChild(document.createTextNode(text[i]
							+ "\r\n"));
				}
			}
		};
	})();
	
	var printStopword = (function () {
		var outputBox;
		var outputBox2;
		return function(text, text2) {
			text = text.replace(/[^\r]\n/g, "\r\n");
			if (!outputBox)
				outputBox = document.getElementById("stopwordBox");
			if(typeof text == "string") {
				outputBox.appendChild(document.createTextNode(text + "\r\n"));
			} else {
				for(var i=0;i<text.length;i++) {
					outputBox.appendChild(document.createTextNode(text[i]
							+ "\r\n"));
				}
			}
			
			text2 = text2.replace(/[^\r]\n/g, "\r\n");
			if (!outputBox2)
				outputBox2 = document.getElementById("stopwordBox2");
			if(typeof text2 == "string") {
				outputBox2.appendChild(document.createTextNode(text2 + "\r\n"));
			} else {
				for(var i=0;i<text2.length;i++) {
					outputBox2.appendChild(document.createTextNode(text2[i]
							+ "\r\n"));
				}
			}
		};
	})();
	
	var printInput = (function () {
		var outputBox;
		return function(text) {
			//text = text.replace(/[^\r]\n/g, "\r\n");
			if (!outputBox)
				outputBox = document.getElementById("inputBox");
			
			if(typeof text !== "string") {
				text = text.join('\r\n');				
			}
			
			$(outputBox).val(text+'\r\n');
			return;
			
			/*
			if(typeof text == "string") {
				outputBox.appendChild(document.createTextNode(text + "\r\n"));
			} else {
				for(var i=0;i<text.length;i++) {
					outputBox.appendChild(document.createTextNode(text[i]
							+ "\r\n"));
				}
			}
			*/
		};
	})();
	
	var selectJsonGrammar = (function () {
		var outputBox;
		return function(text) {
			if (!outputBox)
				outputBox = document.getElementById('inputBox');
			
			outputBox.select();
		};
	})();
	
	var selectJsjcGrammar = (function () {
		var outputBox;
		return function(text) {
			if (!outputBox)
				outputBox = document.getElementById('compileOutBox');
			
			outputBox.select();
		};
	})();
	
	var selectCompiledCode = (function () {
		var outputBox;
		return function(text) {
			if (!outputBox)
				outputBox = document.getElementById('compiledParserOutBox');
			
			outputBox.select();
		};
	})();
	
	
	function createLanguageMenu (arrayLang, defaultSelection){
		
		var menuElem = ['<label for="lang-selector" data-inline="true">Lanuage: </label>',
							'<select name="lang-selector" id="lang-selector">'
						];
		
		if(!defaultSelection){
			menuElem.push('<option>Lanuage</option>');
		}
		
		for(var i=0,size = arrayLang.length; i < size; ++i){
			var lang = arrayLang[i];
			
			createLanguageMenuEntry(lang, menuElem, defaultSelection);
		}
		
		menuElem.push('</select>');
		
		return menuElem.join('');
	}
	
	function createLanguageMenuEntry (lang, menuElem, defaultSelection, value){
		if(!menuElem){
			menuElem = [];
		}
		
		menuElem.push('<option value="');
		if(value){
			menuElem.push(value);
		}
		else {
			menuElem.push(lang);
		}
		
		menuElem.push('"');
		//if(defaultSelection === lang){//for defaultSelection -> initial selection
			//menuElem.push(' data-placeholder="true"');
		//}
		menuElem.push('>');
		menuElem.push(lang);
		menuElem.push('</option>');
		
		return menuElem;
	}
	</script>
	

</head>

<body>
    
    <a name="top"></a>
    <h1>Semantic Parser Test: Grammar Compiler</h1>
    
    <div style="font-size: 0.9em;width: 100%; white-space: normal !important;">
    <strong>NOTE:</strong>
		On initial load of the page, the <tt>Language</tt> list 
    	is loaded from the file <code>config/directories.json</code>: for each found language
    	directory (<code>config/languages/</code>),	an entry is generated -- on selection, the
    	corresponing JSON file is attempted to be read and compiled.<br/>
    	<i>Note, that there may not be a JSON file for the lanuage available -- in this case an
    	 error message will be shown on selection.</i><br/>
    	
    	<p>You can use the file selector, for loading a JSON grammar from  the local file system</p>
    	
    	<p>Alternatively, you can enter (e.g. copy&paste) a JSON-formatted grammar into the 
    	<i>JSON Grammar Definition</i> field and then press the <i>parse</i> button.</p>
    	<br/>
    </div>
    
    <hr/>
    <div>
    TOC: 		<a href="#json-grammer">JSON Grammar</a> | 
    			<a href="#interpreter-tester">TEST interpretation</a> | 
    			<a href="#stopword-tester">TEST stopword processing</a> |
    			<a href="#jsjc-grammar">JS/JC Grammar</a> | 
    			<a href="#compiled-parser">Compiled parser code</a>  
    </div>
    <hr/>
    
    <div style="float:left; width: 70%;">
    	
    	<div style="float:left;">
    	<a href="#top">top</a>  
    	<a name="json-grammar"></a>
	    	<p></p>
		</div>
		<div style="clear:left;"></div>
		<div style="float:left;">
	    	JSON Grammar Definition:
		</div>
		
		<div style="float:right;">
			<div class="grid">
				<div id="language-selection-area" class="grid-cell">
					<div id="lang-selector-manual-input">
						Language: 
						<input type="text" id="lang-selector-field" value="de" />
					</div>
					<div id="lang-selector" style="display:none;"></div>
				</div>
				<div class="grid-cell">
					<input type="file" id="file-selector" accept="text" name="files[]" />
				</div>
				<div class="grid-cell">
					Grammar ID: <input id="grammar-id" type="text" value="de" data-inline="true"/>
				</div>
			</div>
		</div>
		<div style="clear:both;"></div>
		
		<textarea id="inputBox" rows="20" style="width: 100%;height:300px;" data-enhance="false"></textarea><br/>
		
		<div style="float:left;">
			<input type="button" onclick="selectJsonGrammar();" value="Select All" style="right:0;"/>
		</div><div style="float:right;">
			<input type="button" onclick="parseInput();" value="Parse"/>
		</div>
		<div style="clear:both;"></div>
		
		<!-- input type="button" onclick="clearOut();" value="Clear"/-->
		
		<br/>
    </div>
    <div style="float:right; width: 27%;">
    	<br/>
	    <p>Output/Error:</p>
	    <div id="outputBox"></div>
    </div>
	
	<hr/>
	
    <div style="float:left; clear: left; width: 100%;"><div style="clear: right; width: 100%;">
	
		<table width="100%" border="0">
			<tr>
				<td colspan="3">
					<hr/>
    				<a href="#top">top</a>  
					<a name="interpreter-tester"></a><br/>
					Semantic Parser Test: Interpertation
				</td>
			</tr>
			<tr>
				<td valign="top">
					<p>TEST Interpret Sentence:</p>
					<textarea id="interpretationInputBox" rows="1" cols="30"></textarea>
					<br/>
					<input type="button" onclick="processInterpretation();" value="Interpret"/>
					<br/>
					<input type="button" onclick="benchmarkInterpretation();" value="Benchmark"/>
					<br/>
					<span id="time"></span>
					<br/>
					<span id="time-mod"></span>
				</td>
				<td>
					<p>Interpreter Result:</p>
					<div id="interpretationBox"></div>
				</td>
				<td>
					<p>Alternate Interpreter Result (using alternate method for stopword removal):</p>
					<div id="interpretationBoxAlt"></div>
				</td>
			</tr>
			<tr>
				<td colspan="3">
					<hr/>
    				<a href="#top">top</a>
					<a name="stopword-tester"></a><br/>
					Semantic Parser Test: Stopword
				</td>
				
			</tr>
			<tr>
				<td valign="top">
					<p>TEST Process Stopwords:</p>
					<textarea id="stopwordInputBox" rows="1" cols="30"></textarea>
					<input type="button" onclick="stopword();" value="Apply Stopwords"/>
				</td>
				<td>
					<p>Stopword Result (Method 1):</p>
					<div id="stopwordBox"></div>
				</td>
				<td>					
					<p>Stopword Result (Method 2):</p>
					<div id="stopwordBox2"></div>
				</td>
			</tr>
		</table>
		
		<hr/>
		
		<div>
			<a href="#top">top</a>  
			<a name="jsjc-grammar"></a>
		    <p>JS/JC Grammar Definition (generated from JSON grammar):</p>
			<textarea  id="compileOutBox" readonly="readonly"></textarea>
			
			<input type="button" onclick="selectJsjcGrammar();" value="Select All"/>  
		</div>
		
		<hr/>
		
		<div style="width: 100%;">
    		<a href="#top">top</a>  
			<a name="compiled-parser"></a>
			<h2>Compiled Parser Code:</h2>
			<input type="button" onclick="selectCompiledCode();" value="Select All"/>  
			<textarea id="compiledParserOutBox" readonly="readonly"></textarea>
		</div>
    </div></div>
	
</body>
</html>                                                                                                                                                                            